(this["webpackJsonpcollege-sheets"]=this["webpackJsonpcollege-sheets"]||[]).push([[0],{87:function(e,t,n){},88:function(e,t,n){"use strict";n.r(t);for(var c=n(0),a=n(1),r=n(22),l=n.n(r),o=n(3),u=n(17),i=n(6),s=function(e){var t=e.label,n=e.children;return Object(c.jsxs)("div",{className:"home-card",children:[Object(c.jsx)("div",{className:"home-header",children:t}),Object(c.jsx)("div",{className:"home-content",children:n})]})},d=n(4),b=n.n(d),j=n(2),v=n(43),f=n(8),m=n.n(f),O=function(e){var t=e.onChange,n=e.label,a=Object(v.a)(e,["onChange","label"]);return Object(c.jsxs)("div",{className:m()("input",a.className),children:[n&&Object(c.jsx)("div",{className:"input-label",children:n}),Object(c.jsx)("input",Object(j.a)(Object(j.a)({},a),{},{className:"input-field",onChange:function(e){var n=e.target,c=n.name,a=n.value;return t({name:c,value:a})}}))]})},h=function(e){var t,n=e.items,r=e.onEdit,l=e.onAdd,u=e.collectionName,i=e.refetch,s=Object(a.useState)(""),d=Object(o.a)(s,2),j=d[0],v=d[1],f=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.filter((function(e){var t=e.label;return new RegExp(j,"gi").test(t)}))}),[j,n]);return Object(c.jsxs)("div",{className:"mutable-list",children:[Object(c.jsxs)("div",{className:"mutable-list-header",children:[Object(c.jsx)("div",{className:"search",children:Object(c.jsx)(O,{label:"\u041f\u043e\u0438\u0441\u043a",value:j,onChange:function(e){var t=e.value;return v(t)}})}),Object(c.jsx)("button",{onClick:l,className:"create-item",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442"})]}),null===(t=j?f:n)||void 0===t?void 0:t.map((function(e){var t=e.label,n=e.value;return Object(c.jsxs)("div",{className:"list-item",children:[Object(c.jsx)("div",{className:"item-name",children:t}),Object(c.jsxs)("div",{className:"item-actions",children:[Object(c.jsx)("button",{onClick:function(){return r(n)},className:"item-action edit-item",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),Object(c.jsx)("button",{onClick:function(){return function(e,t){confirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 ".concat(t,"?"))&&b.a.delete("".concat("http://localhost:3001","/").concat(u,"/").concat(e)).then(i).catch((function(e){return alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e))}))}(n,t)},className:"item-action delete-item",children:"\xd7"})]})]},"".concat(t,"-").concat(n))}))]})},p=n(18),x=n(14),g=n.n(x),N=n(24),C=n(7),S=n.n(C),k=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),c=1;c<t;c++)n[c-1]=arguments[c];return"".concat("http://localhost:3001").concat(n.join("")).concat(e?"?"+e:"")},y=function(){var e=Object(a.useContext)(Je),t=e.me,n=e.setMe,c=Object(i.f)().push;return{me:t,login:function(e){var t=e.login,a=e.password;b()(k(S.a.stringify({login:t,password:a}),"/users")).then((function(e){var t=e.data,a=null===t||void 0===t?void 0:t[0];if(a){var r=a.id,l=a.password;localStorage.setItem("token","".concat(r,"::").concat(l)),c("/"),n(a)}else alert("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c")}))},authorize:Object(a.useCallback)(Object(N.a)(g.a.mark((function e(){var t,a,r,l,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=localStorage)||void 0===t?void 0:t.getItem("token")){e.next=2;break}return e.abrupt("return",c("/login"));case 2:return a=localStorage.getItem("token").split("::"),r=Object(o.a)(a,2),l=r[0],u=r[1],e.next=5,b()(k(S.a.stringify({id:l,password:u}),"/users")).then((function(e){var t=e.data,a=null===t||void 0===t?void 0:t[0];a||c("/login"),n(a)}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),[])}},w=Object(a.createContext)({}),M=function(e){var t,n=e.children,a=y().me,r=Object(p.a)("".concat("http://localhost:3001","/groups?_sort=name&_order=asc")),l=Object(o.a)(r,2),u=l[0].data,i=l[1],s=Object(p.a)("".concat("http://localhost:3001","/subjects?_sort=name&_order_asc")),d=Object(o.a)(s,2),b=d[0].data,j=d[1],v=Object(p.a)("".concat("http://localhost:3001","/users?role_like=teacher&role_like=curator&_sort=name&_order=asc")),f=Object(o.a)(v,2),m=f[0].data,O=f[1],h=Object(p.a)("".concat("http://localhost:3001","/users?role_like=student&_sort=name&_order=asc")),x=Object(o.a)(h,2),g=x[0].data,N=x[1],C=Object(p.a)("".concat("http://localhost:3001","/sheets?_sort=date&_order=desc").concat((null===a||void 0===a||null===(t=a.role)||void 0===t?void 0:t.includes("admin"))?"":"&teacher=".concat(null===a||void 0===a?void 0:a.id))),S=Object(o.a)(C,2),k=S[0].data,M=S[1];return Object(c.jsx)(w.Provider,{value:{groups:u,refetchGroups:i,subjects:b,refetchSubjects:j,teachers:m,refetchTeachers:O,students:g,refetchStudents:N,sheets:k,refetchSheets:M},children:n})},E=function(){var e=Object(a.useContext)(w);return{subjects:e.subjects,refetchSubjects:e.refetchSubjects}},_=Object(a.createContext)({}),L=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(o.a)(n,2),l=r[0],u=r[1],i=Object(a.useState)(null),s=Object(o.a)(i,2),d=s[0],b=s[1];return Object(c.jsx)(_.Provider,{value:{activeModal:l,openModal:function(e){return u(e)},closeModal:function(){return u(null)},context:d,setContext:b},children:t})},A=function(e){var t=Object(a.useContext)(_),n=t.activeModal,c=t.openModal,r=void 0===c?function(){return null}:c,l=t.closeModal,o=void 0===l?function(){return null}:l,u=t.context,i=t.setContext;return{activeModal:n,open:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r(e),i(t)},close:function(){o(e),i(null)},context:u||{},setContext:i}},G=function(){var e=A("CreateSubject").open,t=E(),n=t.subjects,r=t.refetchSubjects,l=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t=e.id;return{label:e.name,value:t}}),[n])}));return Object(c.jsx)(s,{label:"\u041f\u0440\u0435\u0434\u043c\u0435\u0442\u044b",children:Object(c.jsx)(h,{items:l,collectionName:"subjects",createModalName:"CreateSubject",refetch:r,onEdit:function(t){return e({id:t,label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u043c\u0435\u0442"})},onAdd:function(){return e({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0435\u0434\u043c\u0435\u0442"})}})})},T=function(){var e=Object(a.useContext)(w);return{teachers:e.teachers,refetchTeachers:e.refetchTeachers}},D={student:"\u0421\u0442\u0443\u0434\u0435\u043d\u0442",teacher:"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c",curator:"\u041a\u0443\u0440\u0430\u0442\u043e\u0440",admin:"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440"},F=function(e){return D[e]},I=F,V=function(){var e=A("CreateTeacher").open,t=T(),n=t.teachers,r=t.refetchTeachers,l=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t,n=e.name,c=e.id,a=e.role;return{label:"".concat(n," (").concat((t=a,t.map((function(e){return F(e)}))).join(", "),")"),value:c}}))}),[n]);return Object(c.jsx)(s,{label:"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u0438 \u0438 \u043a\u0443\u0440\u0430\u0442\u043e\u0440\u044b",children:Object(c.jsx)(h,{items:l,collectionName:"users",refetch:r,onEdit:function(t){return e({id:t,label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430"})},onAdd:function(){return e({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430"})}})})},J=function(){var e=Object(a.useContext)(w);return{groups:e.groups,refetchGroups:e.refetchGroups}},P=function(){var e=A("CreateGroup").open,t=J(),n=t.groups,r=t.refetchGroups,l=T().teachers,o=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t,n=e.name,c=e.id,a=e.curator,r=null===l||void 0===l||null===(t=l.find((function(e){return e.id===a})))||void 0===t?void 0:t.name;return{label:"".concat(n," ").concat(r?"(".concat(r,")"):""),value:c}}))}),[n,l]);return Object(c.jsx)(s,{label:"\u0413\u0440\u0443\u043f\u043f\u044b",children:Object(c.jsx)(h,{items:o,collectionName:"groups",refetch:r,onEdit:function(t){return e({id:t,label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"})},onAdd:function(){return e({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"})}})})},q=n(9),z=function(e){switch(e){case"text":return"";case"number":return 0;case"multiselect":return[];default:return null}},B=function(e){var t=e.fields,n=e.cancel,r=e.cancelLabel,l=void 0===r?"\u041e\u0442\u043c\u0435\u043d\u0430":r,u=e.submitLabel,i=void 0===u?"\u041f\u0440\u0438\u043d\u044f\u0442\u044c":u,s=e.onSubmit,d=e.actionClassName,b=e.className,v=e.initialValues,f=A().close,O=Object(a.useState)(v||{}),h=Object(o.a)(O,2),p=h[0],x=h[1],g=Object(a.useCallback)((function(){return s(p)}),[JSON.stringify(p)]),N=Object(a.useCallback)((function(e){var t=e.name,n=e.value;return x((function(e){return Object(j.a)(Object(j.a)({},e),{},Object(q.a)({},t,n))}))}),[JSON.stringify(p)]);return Object(c.jsxs)("form",{className:m()("form",b),onSubmit:function(e){return e.preventDefault()},children:[Object(c.jsx)("div",{className:"form-fields",children:t.map((function(e){var t=e.name,n=e.component,c=e.type,r=e.required,l=e.condition;return(void 0===l?function(){return!0}:l)(p)?Object(a.cloneElement)(n,{required:r,name:t,key:t,onChange:N,value:p[t]||z(c)}):null}))}),Object(c.jsxs)("div",{className:m()("form-actions",d),children:[n&&Object(c.jsx)("button",{onClick:f,className:"form-action cancel",children:l}),Object(c.jsx)("button",{onClick:g,className:"form-action submit",children:i})]})]})},R=function(e){var t=e.options,n=e.onChange,r=e.onAdd,l=e.name,u=e.label,i=e.value,s=e.addLabel,d=void 0===s?"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u044d\u043b\u0435\u043c\u0435\u043d\u0442":s,b=Object(a.useState)(!1),j=Object(o.a)(b,2),v=j[0],f=j[1],m=Object(a.useRef)(null),O=Object(a.useMemo)((function(){var e;return i||(null===t||void 0===t||null===(e=t[0])||void 0===e?void 0:e.value)}),[i]),h=Object(a.useMemo)((function(){var e;return null===t||void 0===t||null===(e=t.find((function(e){var t=e.value;return O===t})))||void 0===e?void 0:e.label}),[i]),p=Object(a.useCallback)((function(e){var t=e.target.classList;if(v||!t.contains("select-option"))return x()}),[v]),x=function(){return f(!1)},g=Object(a.useCallback)((function(){return f((function(e){return!e}))}),[]);Object(a.useEffect)((function(){n({value:O,name:l})}),[O]);return Object(a.useEffect)((function(){return f(!1)}),[O]),Object(a.useEffect)((function(){var e=document.addEventListener("mousedown",p);return document.removeEventListener("mousedown",e)}),[]),Object(c.jsxs)("div",{ref:m,className:"custom-select-container",children:[Object(c.jsxs)("button",{className:"custom-select",name:l,onClick:g,children:[Object(c.jsx)("div",{className:"select-label",children:u}),Object(c.jsx)("div",{className:"select-value",children:h})]}),v&&Object(c.jsxs)("div",{className:"select-options ".concat("select-option-top"),children:[r&&Object(c.jsxs)("div",{role:"button",onMouseDown:function(){x(),r()},className:"select-option",children:[d," +"]}),null===t||void 0===t?void 0:t.map((function(e){var t=e.label,a=e.value;return Object(c.jsx)("div",{role:"button",className:"select-option",onMouseDown:function(){return function(e){return n({value:e,name:l})}(a)},children:t},"".concat(t,"-").concat(a))}))]})]})},Y=function(e){var t=A("CreateGroup").open,n=J().groups,r=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t=e.id;return{label:e.name,value:t}}))}),[n]);return r?Object(c.jsx)(R,Object(j.a)({options:r,label:"\u0413\u0440\u0443\u043f\u043f\u0430",addLabel:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443",onAdd:function(){return t({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443"})}},e)):null},H=function(e){var t=A("CreateSubject").open,n=E().subjects,r=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t=e.id;return{label:e.name,value:t}}))}),[n]);return r?Object(c.jsx)(R,Object(j.a)({options:r,label:"\u0414\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430",addLabel:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0443",onAdd:function(){return t({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0443"})}},e)):null},K=[{label:"\u042f\u043d\u0432\u0430\u0440\u044c",value:"1"},{label:"\u0424\u0435\u0432\u0440\u0430\u043b\u044c",value:"2"},{label:"\u041c\u0430\u0440\u0442",value:"3"},{label:"\u0410\u043f\u0440\u0435\u043b\u044c",value:"4"},{label:"\u041c\u0430\u0439",value:"5"},{label:"\u0418\u044e\u043d\u044c",value:"6"},{label:"\u0418\u044e\u043b\u044c",value:"7"},{label:"\u0410\u0432\u0433\u0443\u0441\u0442",value:"8"},{label:"\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c",value:"9"},{label:"\u041e\u043a\u0442\u044f\u0431\u0440\u044c",value:"10"},{label:"\u041d\u043e\u044f\u0431\u0440\u044c",value:"11"},{label:"\u0414\u0435\u043a\u0430\u0431\u0440\u044c",value:"12"}],Q=function(e){return Object(c.jsx)(R,Object(j.a)({options:K,label:"\u041c\u0435\u0441\u044f\u0446"},e))},U=[],W=0;W<10;W++)U.push({label:((new Date).getFullYear()-W).toString(),value:((new Date).getFullYear()-W).toString()});var X,Z=function(e){return Object(c.jsx)(R,Object(j.a)({options:U,label:"\u0413\u043e\u0434"},e))},$=[{name:"group",component:Object(c.jsx)(Y,{})},{name:"subject",component:Object(c.jsx)(H,{})},{name:"month",component:Object(c.jsx)(Q,{})},{name:"year",component:Object(c.jsx)(Z,{})}],ee=function(){var e=Object(i.f)().push;return Object(c.jsx)(s,{label:"\u041e\u0446\u0435\u043d\u043a\u0438",children:Object(c.jsx)(B,{fields:$,onSubmit:function(t){var n=t||{},c=n.group,a=n.year,r=n.month,l=n.subject,o="".concat(a,"-").concat(r);e("/sheet?"+S.a.stringify({group:c,date:o,subject:l}))}})})},te=function(){var e=Object(a.useContext)(w);return{students:e.students,refetchStudents:e.refetchStudents}},ne=function(){var e=A("CreateStudent").open,t=te(),n=t.students,r=t.refetchStudents,l=J().groups,o=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t,n=e.name,c=e.id,a=e.group,r=(t=[a],l.filter((function(e){var n=e.id;return null===t||void 0===t?void 0:t.includes(n)})).map((function(e){return e.name})).join(", "));return{label:"".concat(n," ").concat(r.length?"(".concat(r,")"):""),value:c}}))}),[n]);return Object(c.jsx)(s,{label:"\u0421\u0442\u0443\u0434\u0435\u043d\u0442\u044b",children:Object(c.jsx)(h,{items:o,collectionName:"users",refetch:r,onEdit:function(t){return e({id:t,label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430"})},onAdd:function(){return e({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430"})}})})},ce=function(){var e=Object(a.useContext)(w);return{sheets:e.sheets,refetchSheets:e.refetchSheets}},ae=function(e){switch(e){case 1:return"\u042f\u043d\u0432\u0430\u0440\u044c";case 2:return"\u0424\u0435\u0432\u0440\u0430\u043b\u044c";case 3:return"\u041c\u0430\u0440\u0442";case 4:return"\u0410\u043f\u0440\u0435\u043b\u044c";case 5:return"\u041c\u0430\u0439";case 6:return"\u0418\u044e\u043d\u044c";case 7:return"\u0418\u044e\u043b\u044c";case 8:return"\u0410\u0432\u0433\u0443\u0441\u0442";case 9:return"\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c";case 10:return"\u041e\u043a\u0442\u044f\u0431\u0440\u044c";case 11:return"\u041d\u043e\u044f\u0431\u0440\u044c";case 12:return"\u0414\u0435\u043a\u0430\u0431\u0440\u044c"}},re=function(){var e=A("CreateSheet").open,t=ce(),n=t.sheets,r=t.refetchSheets,l=J().groups,o=E().subjects,u=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.map((function(e){var t,n,c=e.id,a=e.group,r=e.date,u=e.subject,i=null===l||void 0===l||null===(t=l.find((function(e){var t=e.id;return a===t})))||void 0===t?void 0:t.name,s=null===o||void 0===o||null===(n=o.find((function(e){var t=e.id;return u===t})))||void 0===n?void 0:n.name,d=r.split("-")[0];return{label:[ae(parseInt(null===r||void 0===r?void 0:r.split("-")[1])),d,s,i].join(" "),value:c}}))}),[l,o,n]);return Object(c.jsx)(s,{label:"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0436\u0443\u0440\u043d\u0430\u043b\u0430",children:Object(c.jsx)(h,{items:u,collectionName:"sheets",refetch:r,onEdit:function(t){return e({id:t,label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})},onAdd:function(){return e({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})}})})},le=function(e){var t=e.name,n=e.center,r=e.label,l=e.className,o=e.children,u=A(t),i=u.activeModal,s=u.close,d=function(e){if(e.target.classList.contains("modal"))return s()},b=function(e){if("Escape"===e.key)return s()};return Object(a.useEffect)((function(){var e=document.addEventListener("mousedown",d),t=document.addEventListener("keydown",b);return function(){document.removeEventListener("mousedown",e),document.removeEventListener("mousedown",t)}}),[]),i!==t?null:Object(c.jsx)("div",{className:m()("modal",{center:Boolean(n)}),children:Object(c.jsxs)("div",{className:m()("modal-content",l),children:[Object(c.jsxs)("div",{className:"modal-header",children:[Object(c.jsx)("h6",{className:"modal-label",children:r}),Object(c.jsx)("button",{onClick:s,className:"modal-close",children:"\xd7"})]}),o]})})},oe=function(e){return Object(r.createPortal)(Object(c.jsx)(le,Object(j.a)(Object(j.a)({},e),{},{children:e.children})),document.body)},ue=function(e){return"".concat(e,"_").concat(Math.random().toString(36).substr(2,9))},ie=[{type:"text",name:"name",component:Object(c.jsx)(O,{type:"text",placeholder:"\u041e\u0441\u043d\u043e\u0432\u044b \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 ..."})}],se=function(){var e=A(),t=e.close,n=e.context,r=E().refetchSubjects,l=Object(a.useState)(null),u=Object(o.a)(l,2),i=u[0],s=u[1],d=function(){return b.a.get(k(S.a.stringify({id:n.id}),"/subjects")).then((function(e){var t=e.data;return s(null===t||void 0===t?void 0:t[0])}))};return Object(a.useEffect)((function(){(null===n||void 0===n?void 0:n.id)?d():s(null)}),[null===n||void 0===n?void 0:n.id]),(null===n||void 0===n?void 0:n.id)&&!i?null:Object(c.jsx)(oe,{className:"create-subject",name:"CreateSubject",label:n.label,children:Object(c.jsx)(B,{initialValues:i,fields:ie,onSubmit:function(e){return(null===n||void 0===n?void 0:n.id)?b.a.patch(k("","/subjects/".concat(n.id)),e).then((function(){t(),d(),r()})):b.a.post(k("","/subjects"),Object(j.a)({id:ue("sb")},e)).then((function(){t(),r()}))}})})},de=n(21),be=function(e){var t=e.value,n=e.options,r=e.limit,l=e.name,o=e.label,u=e.onChange,i=Object(a.useMemo)((function(){return n.filter((function(e){var n=e.value;return t.includes(n)}))}),[t]),s=Object(a.useCallback)((function(e){var n=Object(de.a)(t);t.includes(e)?n.splice(t.indexOf(e),1):n.push(e),u({name:l,value:n})}),[t]);return Object(c.jsxs)("div",{className:"multi-select",children:[o&&Object(c.jsx)("label",{className:"multi-select-label",children:o}),Object(c.jsx)("div",{className:"multi-select-active",children:i.map((function(e){var t=e.label,n=e.value;return Object(c.jsx)("button",{onClick:function(){return s(n)},className:"multi-select-active-item",children:t},t)}))}),Object(c.jsx)("div",{className:"multi-select-options",children:n.map((function(e){var t=e.label,n=e.value;return Object(c.jsx)("button",{onClick:function(){return s(n)},disabled:i.length>=r&&!i.some((function(e){var t=e.value;return n===t})),className:m()("select-option",{active:i.some((function(e){var t=e.value;return n===t}))}),children:t},"".concat(t,"-").concat(n))}))})]})},je=function(e){var t=e.name,n=e.value,r=e.onChange,l=e.limit,o=E().subjects,u=Object(a.useMemo)((function(){return o.map((function(e){var t=e.id;return{label:e.name,value:t}}))}),[o]);return Object(c.jsx)(be,{limit:l,name:t,options:u,label:"\u041f\u0440\u0435\u0434\u043c\u0435\u0442\u044b",onChange:r,value:n})},ve=function(e){var t=e.name,n=e.value,r=e.role,l=e.label,o=e.onChange,u=A("CreateTeacher").open,i=T().teachers,s=Object(a.useMemo)((function(){var e=null===i||void 0===i?void 0:i.filter((function(e){var t=e.role;switch(r){case"teacher":return t.includes("teacher");case"curator":return t.includes("curator");default:return!0}}));return null===e||void 0===e?void 0:e.map((function(e){var t=e.id;return{label:e.name,value:t}}))}),[i]);return Object(c.jsx)(R,{label:l,options:s,value:n,name:t,onChange:o,onAdd:function(){return u({label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430"})}})},fe=[{type:"text",name:"name",component:Object(c.jsx)(O,{type:"text",placeholder:"\u041f\u041e\u041a\u0421-11"})},{type:"multiselect",name:"subjects",component:Object(c.jsx)(je,{limit:10})},{name:"curator",component:Object(c.jsx)(ve,{label:"\u041a\u0443\u0440\u0430\u0442\u043e\u0440",role:"curator"})}],me=function(){var e=A(),t=e.close,n=e.context,r=J().refetchGroups,l=Object(a.useState)(null),u=Object(o.a)(l,2),i=u[0],s=u[1],d=function(){return b.a.get(k(S.a.stringify({id:n.id}),"/groups")).then((function(e){var t=e.data;return s(null===t||void 0===t?void 0:t[0])}))};return Object(a.useEffect)((function(){n.id?d():s(null)}),[null===n||void 0===n?void 0:n.id]),(null===n||void 0===n?void 0:n.id)&&!i?null:Object(c.jsx)(oe,{className:"create-group",name:"CreateGroup",label:n.label,children:Object(c.jsx)(B,{initialValues:i,fields:fe,onSubmit:function(e){return(null===n||void 0===n?void 0:n.id)?b.a.patch(k("","/groups/".concat(n.id)),e).then((function(){t(),d(),r()})):b.a.post(k("","/groups"),Object(j.a)({id:ue("gr")},e)).then((function(){t(),r()}))}})})},Oe=[{label:I("teacher"),value:"teacher"},{label:I("curator"),value:"curator"}],he=function(e){var t=e.name,n=e.value,a=e.onChange,r=e.limit;return Object(c.jsx)(be,{name:t,options:Oe,limit:r,label:"\u0420\u043e\u043b\u044c",onChange:a,value:n})},pe=[{type:"text",name:"name",component:Object(c.jsx)(O,{label:"\u0424\u0418\u041e",type:"text",placeholder:"\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d \u0418\u0432\u0430\u043d\u043e\u0432\u0438\u0447"})},{type:"text",name:"login",component:Object(c.jsx)(O,{label:"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430",type:"email"})},{type:"text",name:"password",component:Object(c.jsx)(O,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password"})},{type:"multiselect",name:"role",component:Object(c.jsx)(he,{limit:2,label:"\u041f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c"})},{type:"multiselect",name:"subjects",component:Object(c.jsx)(je,{limit:3,label:"\u041f\u0440\u0435\u0434\u043c\u0435\u0442\u044b"}),condition:function(e){var t;return null===(t=e.role)||void 0===t?void 0:t.includes("teacher")}}],xe=function(){var e=A(),t=e.close,n=e.context,r=T().refetchTeachers,l=J().refetchGroups,u=Object(a.useState)(null),i=Object(o.a)(u,2),s=i[0],d=i[1],v=function(){return b.a.get(k(S.a.stringify({id:n.id}),"/users")).then((function(e){var t=e.data;return d(null===t||void 0===t?void 0:t[0])}))};return Object(a.useEffect)((function(){n.id?v():d(null)}),[null===n||void 0===n?void 0:n.id]),(null===n||void 0===n?void 0:n.id)&&!s?null:Object(c.jsx)(oe,{className:"create-teacher",name:"CreateTeacher",label:n.label,children:Object(c.jsx)(B,{initialValues:s,fields:pe,onSubmit:function(e){return(null===n||void 0===n?void 0:n.id)?b.a.patch(k("","/users/".concat(n.id)),e).then((function(){t(),v(),r(),l()})):b.a.post(k("","/users"),Object(j.a)({id:ue("tc")},e)).then((function(){t(),r()}))}})})},ge=[{type:"text",name:"name",component:Object(c.jsx)(O,{label:"\u0424\u0418\u041e",type:"text",placeholder:"\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d \u0418\u0432\u0430\u043d\u043e\u0432\u0438\u0447"})},{type:"text",name:"group",component:Object(c.jsx)(Y,{label:"\u0413\u0440\u0443\u043f\u043f\u0430"})}],Ne=function(){var e=A(),t=e.close,n=e.context,r=J().refetchGroups,l=te().refetchStudents,u=Object(a.useState)(null),i=Object(o.a)(u,2),s=i[0],d=i[1],v=function(){return b.a.get(k(S.a.stringify({id:n.id}),"/users")).then((function(e){var t=e.data;return d(null===t||void 0===t?void 0:t[0])}))};return Object(a.useEffect)((function(){n.id?v():d(null)}),[null===n||void 0===n?void 0:n.id]),(null===n||void 0===n?void 0:n.id)&&!s?null:Object(c.jsx)(oe,{className:"create-student",name:"CreateStudent",label:n.label,children:Object(c.jsx)(B,{initialValues:s,fields:ge,onSubmit:function(e){return(null===n||void 0===n?void 0:n.id)?b.a.patch(k("","/users/".concat(n.id)),e).then((function(){t(),v(),r(),l()})):b.a.post(k("","/users"),Object(j.a)({id:ue("st"),role:["student"]},e)).then((function(){t(),l()}))}})})},Ce=[{type:"text",name:"date",component:Object(c.jsx)(O,{label:"\u0414\u0430\u0442\u0430 (\u0433\u043e\u0434-\u043c\u0435\u0441\u044f\u0446)",type:"text",placeholder:"2020-11"})},{type:"text",name:"group",component:Object(c.jsx)(Y,{label:"\u0413\u0440\u0443\u043f\u043f\u0430"})},{type:"text",name:"subject",component:Object(c.jsx)(H,{label:"\u041f\u0440\u0435\u0434\u043c\u0435\u0442"})}],Se=function(){var e=y().me,t=A(),n=t.close,r=t.context,l=ce().refetchSheets,u=Object(a.useState)(null),i=Object(o.a)(u,2),s=i[0],d=i[1],v=function(){return b.a.get(k(S.a.stringify({id:r.id}),"/sheets")).then((function(e){var t=e.data;return d(null===t||void 0===t?void 0:t[0])}))},f=Object(a.useCallback)((function(t){if(e)return(null===r||void 0===r?void 0:r.id)?b.a.patch(k("","/sheets/".concat(r.id)),t).then((function(){n(),v(),l()})):b.a.post(k("","/sheets"),Object(j.a)({id:ue("sh"),teacher:null===e||void 0===e?void 0:e.id},t)).then((function(){n(),l()}))}),[e]);return Object(a.useEffect)((function(){r.id?v():d(null)}),[null===r||void 0===r?void 0:r.id]),(null===r||void 0===r?void 0:r.id)&&!s?null:Object(c.jsx)(oe,{className:"create-sheet",name:"CreateSheet",label:r.label,children:Object(c.jsx)(B,{initialValues:s,fields:Ce,onSubmit:f})})},ke=0,ye=1,we=2,Me=3,Ee=4,_e=(X={},Object(q.a)(X,ke,null),Object(q.a)(X,ye,2),Object(q.a)(X,we,3),Object(q.a)(X,Me,4),Object(q.a)(X,Ee,5),"admin"),Le="curator",Ae="teacher",Ge=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],Te=function(){var e=y().me,t=Object(a.useMemo)((function(){return null===e||void 0===e?void 0:e.role}),[e]),n=Object(a.useCallback)((function(){return(null===t||void 0===t?void 0:t.includes(_e))?Object(c.jsxs)(a.Fragment,{children:[Object(c.jsx)(G,{}),Object(c.jsx)(V,{}),Object(c.jsx)(P,{}),Object(c.jsx)(ne,{})]}):(null===t||void 0===t?void 0:t.includes(Le))?(null===t||void 0===t?void 0:t.includes(Ae))?Object(c.jsxs)(a.Fragment,{children:[Object(c.jsx)(re,{}),Object(c.jsx)(ne,{}),Object(c.jsx)(P,{})]}):Object(c.jsxs)(a.Fragment,{children:[Object(c.jsx)(ne,{}),Object(c.jsx)(P,{})]}):(null===t||void 0===t?void 0:t.includes(Ae))?Object(c.jsxs)(a.Fragment,{children:[Object(c.jsx)(re,{}),Object(c.jsx)(ne,{}),Object(c.jsx)(P,{})]}):null}),[t]);return Object(c.jsxs)("div",{className:"page home",children:[Object(c.jsx)(n,{}),Object(c.jsx)(ee,{}),Object(c.jsx)(se,{}),Object(c.jsx)(xe,{}),Object(c.jsx)(Ne,{}),Object(c.jsx)(me,{}),Object(c.jsx)(Se,{})]})},De=function(e){var t=e.value,n=e.onChange,r=e.className,l=e.disabled,u=Object(a.useState)("none"),i=Object(o.a)(u,2),s=i[0],d=i[1];return Object(a.useEffect)((function(){t&&d(t)}),[t]),Object(c.jsxs)("select",{onChange:function(e){var t=e.target.value;return d(t),n(t)},className:m()(r,{error:0===parseInt(s)}),value:s,disabled:l,children:[Object(c.jsx)("option",{value:"none"}),Object(c.jsx)("option",{value:0,children:"\u043d\u0431"}),Object(c.jsx)("option",{value:2,children:"2"}),Object(c.jsx)("option",{value:3,children:"3"}),Object(c.jsx)("option",{value:4,children:"4"}),Object(c.jsx)("option",{value:5,children:"5"})]})},Fe=function(){var e=y().me,t=E().subjects,n=T().teachers,r=Object(a.useState)(!1),l=Object(o.a)(r,2),u=l[0],s=l[1],d=Object(a.useState)(null),v=Object(o.a)(d,2),f=v[0],O=v[1],h=Object(a.useState)([]),p=Object(o.a)(h,2),x=p[0],C=p[1],w=Object(i.g)().search,M=Object(a.useMemo)((function(){return S.a.parse(w)}),[]),_=M.group,L=M.subject,A=M.date;Object(a.useEffect)((function(){_&&L&&A?b.a.get(k(S.a.stringify({group:_,subject:L,date:A}),"/sheets")).then((function(e){var t=e.data;O(t[0]),s(!1)})).catch((function(){return s(!0)})):s(!0)}),[_,L,A]),Object(a.useEffect)((function(){_&&b.a.get(k(S.a.stringify({group:_,role_like:"student"}),"/users")).then((function(e){var t=e.data;return C(t)}))}),[_]),Object(a.useEffect)((function(){f&&b.a.patch(k("","/sheets/"+(null===f||void 0===f?void 0:f.id)),f)}),[JSON.stringify(f)]);var G=Object(a.useMemo)((function(){var e;return null===t||void 0===t||null===(e=t.find((function(e){return e.id===(null===f||void 0===f?void 0:f.subject)})))||void 0===e?void 0:e.name}),[t,f]),D=Object(a.useMemo)((function(){return null===n||void 0===n?void 0:n.find((function(e){return e.id===(null===f||void 0===f?void 0:f.teacher)}))}),[f,n]),F=Object(a.useMemo)((function(){return!(!f&&!e)&&(!!(null===e||void 0===e?void 0:e.role.includes("admin"))||void 0!==(null===f||void 0===f?void 0:f.teacher)&&(null===f||void 0===f?void 0:f.teacher)===(null===e||void 0===e?void 0:e.id))}),[e,f]),I=Object(a.useCallback)(function(){var e=Object(N.a)(g.a.mark((function e(t,n,c){var a,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f&&F){e.next=2;break}return e.abrupt("return");case 2:if("none"!==c){e.next=4;break}return e.abrupt("return",O(Object(j.a)(Object(j.a)({},f),{},{marks:Object(j.a)(Object(j.a)({},f.marks),{},Object(q.a)({},n,Object(de.a)(f.marks[n].filter((function(e){return e.student!==t})))))})));case 4:r=function(){O(Object(j.a)(Object(j.a)({},f),{},{marks:Object(j.a)(Object(j.a)({},f.marks),{},Object(q.a)({},n,[].concat(Object(de.a)(f.marks[n].filter((function(e){return e.student!==t}))),[{student:t,mark:c}])))}))},(null===(a=f.marks)||void 0===a?void 0:a[n])?r():O(Object(j.a)(Object(j.a)({},f),{},{marks:Object(j.a)(Object(j.a)({},f.marks),{},Object(q.a)({},n,[{student:t,mark:c}]))}));case 6:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}(),[f,F]);return u||!f?Object(c.jsx)("div",{children:"Not found"}):Object(c.jsxs)("div",{className:"page sheet",children:[Object(c.jsx)("h3",{children:[G,null===D||void 0===D?void 0:D.name,null===D||void 0===D?void 0:D.login].join(" | ")}),Object(c.jsxs)("table",{className:"table",children:[Object(c.jsx)("thead",{className:"table-head",children:Object(c.jsxs)("tr",{children:[Object(c.jsx)("th",{children:"\u0421\u0442\u0443\u0434\u0435\u043d\u0442 / \u0414\u0435\u043d\u044c"}),Ge.map((function(e){return Object(c.jsx)("th",{children:e},"day-".concat(e))}))]})}),Object(c.jsx)("tbody",{children:null===x||void 0===x?void 0:x.map((function(e){var t=e.id,n=e.name;return Object(c.jsxs)("tr",{children:[Object(c.jsx)("td",{className:"table-cell-container",children:Object(c.jsx)("div",{className:"table-cell table-cell-name",children:n})}),Ge.map((function(e){var n,a,r,l=null===f||void 0===f||null===(n=f.marks)||void 0===n||null===(a=n[e])||void 0===a||null===(r=a.find((function(e){return e.student===t})))||void 0===r?void 0:r.mark;return Object(c.jsx)("td",{className:"table-cell-container",children:Object(c.jsx)(De,{disabled:!F,value:l,className:m()("table-cell","table-mark"),onChange:function(n){return I(t,e,n)}})},"".concat(t,"-day-").concat(e))}))]},t)}))})]})]})},Ie=function(){var e=y().login,t=Object(a.useState)(""),n=Object(o.a)(t,2),r=n[0],l=n[1],u=Object(a.useState)(""),i=Object(o.a)(u,2),s=i[0],d=i[1],b=function(e){var t=e.target,n=t.value;switch(t.name){case"username":return l(n);case"password":return d(n)}};return Object(c.jsxs)("form",{onSubmit:function(t){return t.preventDefault(),e({login:r,password:s})},className:"form-home",children:[Object(c.jsx)("h4",{children:"\u0412\u0445\u043e\u0434 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443"}),Object(c.jsx)("input",{value:r,name:"username",type:"text",placeholder:"\u041b\u043e\u0433\u0438\u043d - admin",onChange:b}),Object(c.jsx)("input",{value:s,name:"password",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c - 1234",onChange:b}),Object(c.jsx)("button",{type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"})]})},Ve=function(){var e=y().authorize;return Object(a.useEffect)((function(){return e()}),[]),Object(c.jsxs)(i.c,{children:[Object(c.jsx)(i.a,{exact:!0,path:"/",component:Te}),Object(c.jsx)(i.a,{exact:!0,path:"/sheet",component:Fe}),Object(c.jsx)(i.a,{exact:!0,path:"/login",component:Ie})]})},Je=Object(a.createContext)(null),Pe=function(){var e=Object(a.useState)(void 0),t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(c.jsx)(u.a,{children:Object(c.jsx)(Je.Provider,{value:{me:n,setMe:r},children:Object(c.jsx)(M,{children:Object(c.jsx)(L,{children:Object(c.jsx)(Ve,{})})})})})};n(87);l.a.render(Object(c.jsx)(Pe,{}),document.getElementById("root"))}},[[88,1,2]]]);
//# sourceMappingURL=main.123302b9.chunk.js.map